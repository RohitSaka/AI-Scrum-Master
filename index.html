<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IG AI Agile Platform</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --ig-cyan: #22d3ee; --ig-yellow: #facc15; --ig-magenta: #e879f9; --ig-navy: #0f172a; }
        body { font-family: 'Inter', sans-serif; background-color: var(--ig-navy); color: #f8fafc; }
        .active-tab { background: rgba(255, 255, 255, 0.1); border-left: 4px solid var(--ig-cyan); }
        
        /* Sticky Note Styles */
        .sticky-note { 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: grab;
        }
        .sticky-note:active { cursor: grabbing; transform: scale(1.02); }
        .sticky-green { background: #dcfce7; color: #14532d; border-left: 4px solid #22c55e; }
        .sticky-red { background: #fee2e2; color: #7f1d1d; border-left: 4px solid #ef4444; }
        .sticky-blue { background: #dbeafe; color: #1e3a8a; border-left: 4px solid #3b82f6; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion; // Framer Motion
        const API_BASE = "https://ai-scrum-master-cm2c.onrender.com"; 

        // [KEEP YOUR EXISTING APP/NAV COMPONENT CODE HERE]
        // ... (Sidebar, DashboardView, BurndownView code is unchanged) ...

        // --- NEW: INTERACTIVE RETRO BOARD ---
        function RetroView({ project }) {
            const [board, setBoard] = useState({ well: [], improve: [], actions: [] });
            const [input, setInput] = useState("");
            const [activeCol, setActiveCol] = useState("well");

            // Load initial state
            useEffect(() => {
                fetch(`${API_BASE}/retro/${project}`)
                    .then(res => res.json())
                    .then(setBoard);
            }, [project]);

            // Save state to backend whenever it changes
            const saveBoard = (newBoard) => {
                setBoard(newBoard);
                fetch(`${API_BASE}/retro/update`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ project, board: newBoard })
                });
            };

            const addCard = () => {
                if (!input.trim()) return;
                const newBoard = { ...board, [activeCol]: [...board[activeCol], { id: Date.now(), text: input }] };
                saveBoard(newBoard);
                setInput("");
            };

            const deleteCard = (col, id) => {
                const newBoard = { ...board, [col]: board[col].filter(c => c.id !== id) };
                saveBoard(newBoard);
            };

            const promoteToJira = (text) => {
                fetch(`${API_BASE}/retro/promote`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ project, text })
                }).then(() => alert("‚úÖ Ticket Created in Jira!"));
            };

            // Simple Drag-and-Drop Handler (Simplified for React)
            const moveCard = (card, fromCol, toCol) => {
                const newBoard = { ...board };
                newBoard[fromCol] = newBoard[fromCol].filter(c => c.id !== card.id);
                newBoard[toCol] = [...newBoard[toCol], card];
                saveBoard(newBoard);
            };

            return (
                <div class="h-full flex flex-col">
                    <header class="mb-6 flex justify-between items-center">
                        <div>
                            <h2 class="text-3xl font-bold text-white">Retrospective Board</h2>
                            <p class="text-slate-400 text-sm">Collaborative space. Drag to move ideas.</p>
                        </div>
                        <div class="flex gap-2 bg-slate-800 p-1 rounded-lg">
                            {['well', 'improve', 'actions'].map(col => (
                                <button 
                                    key={col}
                                    onClick={() => setActiveCol(col)}
                                    class={`px-4 py-2 rounded text-sm font-bold capitalize transition ${activeCol === col ? 'bg-slate-600 text-white' : 'text-slate-400 hover:text-white'}`}
                                >
                                    {col === 'well' ? 'Went Well' : col === 'improve' ? 'To Improve' : 'Action Items'}
                                </button>
                            ))}
                        </div>
                    </header>

                    {/* INPUT AREA */}
                    <div class="mb-8 flex gap-2">
                        <input 
                            value={input} 
                            onChange={e => setInput(e.target.value)} 
                            onKeyDown={e => e.key === 'Enter' && addCard()}
                            placeholder={`Add a note to '${activeCol === 'well' ? 'Went Well' : activeCol === 'improve' ? 'To Improve' : 'Action Items'}'...`} 
                            class="flex-1 p-4 rounded-xl bg-slate-800 text-white border border-slate-700 outline-none focus:border-[var(--ig-cyan)] transition shadow-lg" 
                        />
                        <button onClick={addCard} class="bg-[var(--ig-cyan)] text-slate-900 px-8 rounded-xl font-bold hover:brightness-110 transition shadow-lg shadow-cyan-500/20">
                            Post Note
                        </button>
                    </div>

                    {/* BOARD COLUMNS */}
                    <div class="grid grid-cols-3 gap-6 flex-1 overflow-hidden">
                        <RetroColumn 
                            title="üöÄ What Went Well" 
                            items={board.well} 
                            color="sticky-green" 
                            onDelete={(id) => deleteCard('well', id)}
                            onMove={(card) => moveCard(card, 'well', 'actions')}
                        />
                        <RetroColumn 
                            title="üî• Needs Improvement" 
                            items={board.improve} 
                            color="sticky-red" 
                            onDelete={(id) => deleteCard('improve', id)}
                            onMove={(card) => moveCard(card, 'improve', 'actions')}
                        />
                        <RetroColumn 
                            title="‚úÖ Action Items" 
                            items={board.actions} 
                            color="sticky-blue" 
                            isAction={true}
                            onDelete={(id) => deleteCard('actions', id)}
                            onPromote={promoteToJira}
                        />
                    </div>
                </div>
            );
        }

        function RetroColumn({ title, items, color, onDelete, onMove, isAction, onPromote }) {
            return (
                <div class="bg-slate-800/50 rounded-2xl p-4 flex flex-col border border-slate-700/50">
                    <h3 class="font-bold text-slate-300 mb-4 uppercase tracking-widest text-xs flex justify-between">
                        {title} <span class="bg-slate-700 px-2 rounded-full text-white">{items.length}</span>
                    </h3>
                    <div class="flex-1 overflow-y-auto space-y-3 pr-2">
                        <AnimatePresence>
                            {items.map(card => (
                                <motion.div 
                                    key={card.id}
                                    initial={{ opacity: 0, y: 20 }}
                                    animate={{ opacity: 1, y: 0 }}
                                    exit={{ opacity: 0, scale: 0.9 }}
                                    layout
                                    class={`sticky-note p-4 rounded-lg relative group ${color}`}
                                >
                                    <p class="font-medium text-sm leading-relaxed">{card.text}</p>
                                    
                                    <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition flex gap-1">
                                        {!isAction && (
                                            <button onClick={() => onMove(card)} title="Move to Actions" class="p-1 bg-white/50 hover:bg-white rounded text-xs">
                                                ‚û°Ô∏è
                                            </button>
                                        )}
                                        <button onClick={() => onDelete(card.id)} title="Delete" class="p-1 bg-white/50 hover:bg-red-500 hover:text-white rounded text-xs">
                                            ‚úï
                                        </button>
                                    </div>

                                    {isAction && (
                                        <button 
                                            onClick={() => onPromote(card.text)}
                                            class="mt-3 w-full py-2 bg-white/30 hover:bg-white/50 rounded text-xs font-bold flex items-center justify-center gap-2 transition"
                                        >
                                            ‚ö° Create Jira Ticket
                                        </button>
                                    )}
                                </motion.div>
                            ))}
                        </AnimatePresence>
                        {items.length === 0 && (
                            <div class="text-center py-10 opacity-20 text-4xl border-2 border-dashed border-slate-600 rounded-xl">
                                +
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        // ... (Keep the rest of your App code)
    </script>
</body>
</html>