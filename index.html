<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Scrum Master Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- CONFIG ---
        const API_BASE = "https://ai-scrum-master-cm2c.onrender.com"; 
        const BOARDS = [
            { key: "SCRUM", name: "Provider Services" },
            { key: "OT", name: "Ops Team (Kanban)" }
        ];

        function Dashboard() {
            const [activeBoard, setActiveBoard] = useState(BOARDS[0]);
            const [data, setData] = useState(null);
            const [loading, setLoading] = useState(true);

            // Fetch data whenever the active board changes
            useEffect(() => {
                setLoading(true);
                fetch(`${API_BASE}/analytics/${activeBoard.key}`)
                    .then(res => res.json())
                    .then(json => {
                        setData(json);
                        setLoading(false);
                    })
                    .catch(err => {
                        console.error("Error:", err);
                        setLoading(false);
                    });
            }, [activeBoard]);

            return (
                <div class="p-6 max-w-7xl mx-auto">
                    {/* HEADER */}
                    <header class="mb-10 flex flex-col md:flex-row justify-between items-center border-b border-slate-700 pb-6 gap-4">
                        <div>
                            <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">
                                AI Scrum Master
                            </h1>
                            <p class="text-slate-400 mt-1">Autonomous Project Intelligence</p>
                        </div>
                        
                        {/* PROJECT SWITCHER */}
                        <div class="flex items-center gap-3 bg-slate-800 p-2 rounded-lg border border-slate-700">
                            <span class="text-sm text-slate-400 pl-2">Board:</span>
                            <select 
                                class="bg-slate-700 text-white p-2 rounded hover:bg-slate-600 outline-none transition cursor-pointer font-bold"
                                value={activeBoard.key}
                                onChange={(e) => setActiveBoard(BOARDS.find(b => b.key === e.target.value))}
                            >
                                {BOARDS.map(board => (
                                    <option key={board.key} value={board.key}>
                                        {board.name}
                                    </option>
                                ))}
                            </select>
                        </div>
                    </header>

                    {/* CONTENT AREA */}
                    {loading ? (
                        <div class="flex flex-col h-64 items-center justify-center space-y-4">
                            <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                            <div class="text-xl font-mono text-blue-300 animate-pulse">
                                ðŸ¤– AI is analyzing {activeBoard.name}...
                            </div>
                        </div>
                    ) : (
                        <div class="space-y-8 animate-fade-in">
                            
                            {/* AI SUMMARY CARD */}
                            <section class="glass p-8 rounded-2xl border-l-8 border-yellow-500 shadow-2xl">
                                <h2 class="text-2xl font-bold mb-4 flex items-center gap-2 text-yellow-400">
                                    <span>ðŸš€</span> Executive Summary
                                </h2>
                                <p class="text-lg leading-relaxed text-slate-200 italic font-medium">
                                    "{data?.sprint_summary || "No data available for this board."}"
                                </p>
                            </section>

                            {/* TEAM PERFORMANCE GRID */}
                            <section>
                                <h2 class="text-2xl font-bold mb-6 text-slate-100">Team Insights</h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {data?.assignee_performance?.length > 0 ? (
                                        data.assignee_performance.map((person, i) => (
                                            <div key={i} class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-blue-500 transition shadow-lg hover:shadow-blue-500/10 group">
                                                <div class="flex items-center gap-3 mb-3">
                                                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center font-bold text-lg">
                                                        {person.name.charAt(0)}
                                                    </div>
                                                    <h3 class="font-bold text-lg group-hover:text-blue-400 transition">{person.name}</h3>
                                                </div>
                                                <p class="text-slate-400 text-sm leading-relaxed">
                                                    {person.analysis}
                                                </p>
                                            </div>
                                        ))
                                    ) : (
                                        <div class="col-span-full text-center py-10 text-slate-500 bg-slate-800/50 rounded-xl">
                                            No active tickets found for {activeBoard.name}.
                                        </div>
                                    )}
                                </div>
                            </section>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>
</html>
